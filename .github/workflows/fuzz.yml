name: Fuzz (Thorough)

on:
  schedule:
    - cron: "0 6 * * 1"  # Monday 6am UTC
  workflow_dispatch:
  push:
    tags:
      - "v*"

permissions:
  contents: read

jobs:
  fuzz:
    name: Fuzz
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # v6.0.2
      - uses: actions/setup-go@7a3fe6cf4cb3a834922a1244abfce67bcef6a0c5 # v6.2.0
        with:
          go-version: "1.26"
      - name: Run thorough fuzz tests
        run: |
          go test -fuzz=FuzzResolvePath -fuzztime=2m -timeout=3m -run=^$ ./internal/mcpserver/
          go test -fuzz=FuzzSplitAndTrim -fuzztime=2m -timeout=3m -run=^$ ./internal/mcpserver/
          go test -fuzz=FuzzConfigParse -fuzztime=2m -timeout=3m -run=^$ ./internal/config/
          go test -fuzz=FuzzBeadParse -fuzztime=2m -timeout=3m -run=^$ ./internal/beads/
